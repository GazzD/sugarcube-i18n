const t={debug:!0,fallbackLng:"en",resources:{}};async function n(){var n;await(n="https://unpkg.com/i18next@latest/i18next.min.js",new Promise((t,e)=>{if(window.i18next)return t();const i=document.createElement("script");i.src=n,i.onload=t,i.onerror=()=>e(new Error(`Failed to load ${n}`)),document.head.appendChild(i)})),function(){const n="i18n",e="i18n-";Story.filter(function(t){return t.tags.includes(n)}).forEach(i=>{try{let s="en";if(!i.title.startsWith(e))return void console.warn(`[i18n] Passage "${i.title}" has tag '${n}' but name does not start with "${e}". Skipping.`);s=i.title.substring(5);const a=JSON.parse(i.text);t.resources[s]||(t.resources[s]={translation:{}}),Object.assign(t.resources[s].translation,a),console.log(`[i18n] Loaded data passage: ${i.title} (${s})`)}catch(t){console.error(`[i18n] Failed to parse JSON in passage "${i.title}":`,t)}})}();let e="en";settings.i18n_lang?e=settings.i18n_lang:navigator.language&&(e=navigator.language.split("-")[0]),await i18next.init({...t,lng:e,interpolation:{escapeValue:!1}}),console.log(`[i18n] Initialized (${i18next.language})`)}function e(t){return settings.i18n_lang!==t&&(settings.i18n_lang=t,Setting.save()),i18next.changeLanguage(t)}function i(t,n={}){return window.i18next?i18next.t(t,n):t}Macro.add("loadTranslations",{handler:function(){if(this.args.length<2)return this.error("Usage: <<loadTranslations 'path' 'langCode'>>");const t=this.args[0],n=this.args[1];fetch(t).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(e=>{window.i18next&&(i18next.addResourceBundle(n,"translation",e,!0,!0),console.log(`[i18n] Loaded translations for ${n} from ${t}`),i18next.language===n&&Engine.show())}).catch(n=>{console.error(`[i18n] Failed to load ${t}:`,n),$(this.output).append(`<span class="error">i18n Error: Failed to load ${t}</span>`)})}}),Macro.add("setLang",{handler(){e(this.args[0]).then(()=>Engine.show())}}),Macro.add("t",{handler(){if(0===this.args.length)return this.error("Usage: <<t 'key' [options]>>");const t=this.args[0];let n={};const e=this.args[1];if(this.args.length>1&&"object"==typeof e&&!Array.isArray(e))n=e;else{if((this.args.length-1)%2!=0)return this.error("<<t>> expects key-value pairs or an options object");for(let t=1;t<this.args.length;t+=2)n[this.args[t]]=this.args[t+1]}const s=i(t,n);$(this.output).append($("<span>").html(s))}}),Macro.add("tlink",{handler(){const t=this.args[0],n=this.args[1];let e={};if(this.args.length>2){const t=this.args[2];if(t&&"object"==typeof t)e=t;else for(let t=2;t<this.args.length;t+=2)e[this.args[t]]=this.args[t+1]}const s=i(t,e);new Wikifier(this.output,`<<link "${s}" "${n}">><</link>>`)}}),async function(){try{var t=LoadScreen.lock();await n(),LoadScreen.unlock(t)}catch(t){console.error("[i18n] Init failed",t)}}(),function(){const t=function(){const t="i18n-",n=Story.filter(t=>t.tags.includes("i18n")),e=new Set;return e.add("en"),n.forEach(n=>{n.title.startsWith(t)&&e.add(n.title.substring(5))}),Array.from(e)}();t.length>1&&Setting.addList("i18n_lang",{label:"Language",list:t,default:settings.i18n_lang||t[0],onInit:function(){},onChange:function(){const t=settings.i18n_lang;window.i18next&&t&&e(t).then(()=>Engine.show())}})}(),$(document).on(":storyready",()=>{settings.i18n_lang&&window.i18next&&i18next.language!==settings.i18n_lang&&e(settings.i18n_lang)});
//# sourceMappingURL=sugarcube-i18n.esm.js.map
