const t="lang",e={debug:!0,fallbackLng:"en",resources:{}};async function a(){var a;await(a="https://unpkg.com/i18next@latest/i18next.min.js",new Promise((t,e)=>{if(window.i18next)return t();const n=document.createElement("script");n.src=a,n.onload=t,n.onerror=()=>e(new Error(`Failed to load ${a}`)),document.head.appendChild(n)}));let n="en";State.variables[t]?n=State.variables[t]:navigator.language&&(n=navigator.language.split("-")[0]),await i18next.init({...e,lng:n,interpolation:{escapeValue:!1}}),State.variables[t]||(State.variables[t]=i18next.language),console.log(`[i18n] Initialized (${i18next.language})`)}function n(t,e={}){return window.i18next?i18next.t(t,e):t}Macro.add("loadTranslations",{handler:function(){if(this.args.length<2)return this.error("Usage: <<loadTranslations 'path' 'langCode'>>");const t=this.args[0],e=this.args[1];fetch(t).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(a=>{window.i18next&&(i18next.addResourceBundle(e,"translation",a,!0,!0),console.log(`[i18n] Loaded translations for ${e} from ${t}`),i18next.language===e&&Engine.show())}).catch(e=>{console.error(`[i18n] Failed to load ${t}:`,e),$(this.output).append(`<span class="error">i18n Error: Failed to load ${t}</span>`)})}}),Macro.add("setLang",{handler(){(function(e){return i18next.changeLanguage(e).then(()=>{State.variables[t]=e})})(this.args[0]).then(()=>Engine.show())}}),Macro.add("t",{handler(){if(0===this.args.length)return this.error("Usage: <<t 'key' [options]>>");const t=this.args[0];let e={};const a=this.args[1];if(this.args.length>1&&"object"==typeof a&&!Array.isArray(a))e=a;else{if((this.args.length-1)%2!=0)return this.error("<<t>> expects key-value pairs or an options object");for(let t=1;t<this.args.length;t+=2)e[this.args[t]]=this.args[t+1]}const r=n(t,e);$(this.output).append($("<span>").html(r))}}),Macro.add("tlink",{handler(){const t=this.args[0],e=this.args[1];let a={};if(this.args.length>2){const t=this.args[2];if(t&&"object"==typeof t)a=t;else for(let t=2;t<this.args.length;t+=2)a[this.args[t]]=this.args[t+1]}const r=n(t,a);new Wikifier(this.output,`<<link "${r}" "${e}">><</link>>`)}}),async function(){try{var t=LoadScreen.lock();await a(),LoadScreen.unlock(t)}catch(t){console.error("[i18n] Init failed",t)}}(),Save.onLoad.add(e=>{const a=e?.state?.history?.[e.state.index],n=a?.variables?.[t];n&&window.i18next&&i18next.changeLanguage(n)}),$(document).on(":storyready",()=>{window.i18next&&State.variables[t]&&i18next.changeLanguage(State.variables[t])});
//# sourceMappingURL=sugarcube-i18n.esm.js.map
